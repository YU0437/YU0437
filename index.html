<!DOCTYPE html>
<html lang="zh-CN">
<head>
	<meta charset="UTF-8">
	<title>高级游戏物品设计工具 - 专业版</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.0/font/bootstrap-icons.css" rel="stylesheet">

	<style>
        :root {
            --primary-color: #4e73df;
            --secondary-color: #858796;
            --success-color: #1cc88a;
            --info-color: #36b9cc;
            --warning-color: #f6c23e;
            --danger-color: #e74a3b;
            --light-color: #f8f9fc;
            --dark-color: #5a5c69;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f7fa;
            color: #333;
        }

        .container {
            max-width: 1400px;
            padding: 20px;
        }

        .header {
            background: linear-gradient(135deg, var(--primary-color), #224abe);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            font-weight: 700;
            margin-bottom: 5px;
        }

        .header .subtitle {
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .card {
            border: none;
            border-radius: 10px;
            box-shadow: 0 2px 15px rgba(0, 0, 0, 0.05);
            margin-bottom: 20px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        //.card:hover {
        //    transform: translateY(-5px);
        //    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        //}

        .card-header {
            background-color: white;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
            font-weight: 600;
            padding: 15px 20px;
            border-radius: 10px 10px 0 0 !important;
        }

        .card-body {
            padding: 20px;
        }

        .item-list-container {
            height: 500px;
            overflow: hidden;
            position: relative;
        }

        .item-list {
            height: 100%;
            overflow-y: auto;
            padding-right: 5px;
        }

        .item-list-item {
            padding: 12px 15px;
            border-radius: 8px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            border-left: 4px solid transparent;
            background-color: white;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }

        .item-list-item:hover {
            background-color: #f8f9fc;
            border-left-color: var(--primary-color);
        }

        .item-list-item.active {
            background-color: #f0f4ff;
            border-left-color: var(--primary-color);
            font-weight: 500;
        }

        .item-list-item .item-meta {
            font-size: 0.85rem;
            color: var(--secondary-color);
        }

        .effect-card {
            background-color: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
            border-left: 3px solid var(--primary-color);
        }

        .effect-card .effect-actions {
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .effect-card:hover .effect-actions {
            opacity: 1;
        }

        .effect-description {
            background-color: #f8f9fc;
            padding: 10px;
            border-radius: 5px;
            font-size: 0.95rem;
            line-height: 1.5;
        }

        .form-control, .form-select {
            border-radius: 8px;
            padding: 10px 15px;
            border: 1px solid #d1d3e2;
        }

        .form-control:focus, .form-select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.2rem rgba(78, 115, 223, 0.25);
        }

        .btn {
            border-radius: 8px;
            padding: 10px 20px;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        .btn-primary {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }

        .btn-primary:hover {
            background-color: #2e59d9;
            border-color: #2653d4;
        }

        .btn-outline-secondary {
            color: var(--secondary-color);
            border-color: #d1d3e2;
        }

        .btn-outline-secondary:hover {
            background-color: #f8f9fc;
            border-color: #b7b9cc;
        }

        .badge {
            font-weight: 500;
            padding: 5px 10px;
            border-radius: 50px;
        }

        .badge-common {
            background-color: #d1d3e2;
            color: #4e4e4e;
        }

        .badge-uncommon {
            background-color: #1cc88a;
            color: white;
        }

        .badge-rare {
            background-color: #36b9cc;
            color: white;
        }

        .badge-epic {
            background-color: #9b51e0;
            color: white;
        }

        .badge-legendary {
            background-color: #f6c23e;
            color: #4e4e4e;
        }

        .required-field::after {
            content: " *";
            color: var(--danger-color);
        }

        .nav-tabs .nav-link {
            border: none;
            color: var(--secondary-color);
            font-weight: 500;
            padding: 10px 20px;
        }

        .nav-tabs .nav-link.active {
            color: var(--primary-color);
            border-bottom: 2px solid var(--primary-color);
            background-color: transparent;
        }

        .tab-content {
            padding: 20px 0;
        }

        .json-editor {
            font-family: 'Fira Code', 'Courier New', monospace;
            min-height: 300px;
            min-width: 100%;
            border-radius: 15px;
            padding: 15px;
            border: 1px solid #51ced6;
        }

        .tooltip-inner {
            max-width: 300px;
            padding: 10px;
            background-color: var(--dark-color);
            font-size: 0.9rem;
        }

        .multiselect-container {
            position: relative;
        }

        .multiselect-container .form-control {
            padding-right: 40px;
        }

        .multiselect-container .select-all-buttons {
            position: absolute;
            right: 5px;
            top: 5px;
        }

        .effect-preview {
            background-color: #f8f9fc;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            border-left: 3px solid var(--info-color);
        }

        .effect-preview-title {
            font-weight: 600;
            color: var(--dark-color);
            margin-bottom: 10px;
        }

        .effect-preview-content {
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            white-space: pre-wrap;
            background-color: white;
            padding: 10px;
            border-radius: 5px;
            max-height: 200px;
            overflow-y: auto;
        }

        /* 添加效果模板库相关样式 */
        #effectTemplatesCollapse {
            transition: all 0.3s ease;
        }

        #effectTemplatesCollapse .card {
            border: 1px solid rgba(0, 0, 0, 0.1);
            box-shadow: none;
        }

        #effectTemplatesCollapse .nav-tabs .nav-link {
            padding: 8px 12px;
            font-size: 0.85rem;
        }

        #effectTemplatesCollapse .list-group-item {
            padding: 10px 15px;
            font-size: 0.9rem;
        }

        .template-item {
            text-align: left;
            transition: all 0.2s ease;
        }

        .template-item:hover {
            background-color: #f8f9fc;
            transform: translateX(3px);
        }

        /* 效果模板库模态框样式 */
        #templatesModal .modal-body {
            padding: 0;
        }

        #templatesModal .tab-content {
            min-height: 400px;
        }

        .template-item {
            cursor: pointer;
            transition: all 0.2s ease;
            border: 1px solid rgba(0, 0, 0, 0.1);
        }

        .template-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border-color: var(--primary-color);
        }

        .template-item .card-title {
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }

        .template-item .card-text {
            font-size: 0.85rem;
        }

        /* 响应式调整 */
        @media (max-width: 768px) {
            #templatesModal .modal-dialog {
                margin: 0.5rem;
            }

            #templatesModal .tab-content {
                min-height: 300px;
            }
        }

        /* 动画效果 */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-fade-in {
            animation: fadeIn 0.3s ease forwards;
        }


        /* 响应式调整 */
        @media (max-width: 992px) {
            .item-list-container {
                height: 300px;
                margin-bottom: 20px;
            }
        }

        @media (max-width: 768px) {
            .json-editor {
                min-height: 150px;
            }

            #jsonEditorCollapse .btn {
                padding: 0.25rem 0.5rem;
                font-size: 0.8rem;
            }
        }

        /* 自定义滚动条 */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }

        .editing-effect {
            border: 2px solid #0d6efd;
            box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
            transition: all 0.3s ease;
        }

        /* 在现有样式之后添加以下内容 */

        /* 手机端适配 */
        @media (max-width: 768px) {
            /* 整体布局调整 */
            .container {
                padding: 10px;
            }

            /* 头部调整 */
            .header {
                padding: 15px;
                margin-bottom: 15px;
            }

            .header h1 {
                font-size: 1.5rem;
            }

            .header .subtitle {
                font-size: 0.9rem;
            }

            /* 卡片调整 */
            .card {
                margin-bottom: 15px;
            }

            .card-header {
                padding: 10px 15px;
                font-size: 0.95rem;
            }

            .card-body {
                padding: 15px;
            }

            /* 表单元素调整 */
            .form-control, .form-select, .btn {
                padding: 12px 15px;
                font-size: 1rem;
            }

            /* 物品列表调整 */
            .item-list-container {
                height: 300px;
                margin-bottom: 15px;
            }

            .item-list-item {
                padding: 10px 12px;
            }

            /* 效果卡片调整 */
            .effect-card {
                padding: 12px;
            }

            /* 按钮组调整 */
            .btn-group .btn {
                padding: 8px 12px;
            }

            /* JSON编辑器调整 */
            .json-editor {
                min-height: 200px;
                font-size: 0.9rem;
                padding: 10px;
            }

            /* 标签页调整 */
            .nav-tabs .nav-link {
                padding: 8px 12px;
                font-size: 0.9rem;
            }

            /* 隐藏部分非必要元素 */
            .item-meta {
                display: none;
            }

            /* 调整模态框 */
            .modal-dialog {
                margin: 0.5rem;
            }

            /* 调整表格显示 */
            .table-responsive {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }

            /* 效果模板库调整 */
            #effectTemplatesCollapse .card {
                margin-bottom: 10px;
            }

            /* 调整表单布局 */
            .row.mb-3 > [class*="col-"] {
                margin-bottom: 10px;
            }

            /* 调整按钮间距 */
            .d-flex.justify-content-between > .btn {
                margin-bottom: 8px;
            }

            /* 调整效果表单 */
            #effectDynamicFields .mb-3 {
                margin-bottom: 10px !important;
            }

            /* 调整嵌套字段 */
            .nested-field-group {
                padding: 8px;
            }
        }

        /* 非常小的设备 (如iPhone 5/SE) */
        @media (max-width: 320px) {
            .container {
                padding: 5px;
            }

            .header {
                padding: 10px;
            }

            .header h1 {
                font-size: 1.3rem;
            }

            .form-control, .form-select, .btn {
                padding: 10px 12px;
                font-size: 0.9rem;
            }

            .card-header {
                padding: 8px 10px;
            }

            .card-body {
                padding: 10px;
            }

            .btn-sm {
                padding: 5px 8px;
                font-size: 0.8rem;
            }
        }

        /* 横向模式优化 */
        @media (max-width: 768px) and (orientation: landscape) {
            .item-list-container {
                height: 200px;
            }

            .json-editor {
                min-height: 150px;
            }
        }

        /* 触摸优化 */
        @media (hover: none) {
            /* 增大触摸目标尺寸 */
            .btn, .form-control, .form-select, .nav-tabs .nav-link {
                min-height: 44px; /* Apple推荐的最小触摸目标尺寸 */
            }

            /* 效果卡片操作按钮始终显示 */
            .effect-card .effect-actions {
                opacity: 1 !important;
            }

            /* 禁用悬停效果 */
            .card:hover {
                transform: none;
                box-shadow: none;
            }

            .item-list-item:hover {
                background-color: inherit;
                border-left-color: transparent;
            }
        }
	</style>
</head>
<body>
<button id="mobileMenuBtn" class="d-lg-none btn btn-primary fixed-top m-3" style="z-index: 1050;">
	<i class="bi bi-list"></i> 菜单
</button>

<!-- 在容器div之后添加移动底部导航 -->
<div class="d-lg-none fixed-bottom bg-white p-2 shadow-lg" style="z-index: 1040;">
	<div class="d-flex justify-content-around">
		<button class="btn btn-outline-primary" id="mobileAddItemBtn">
			<i class="bi bi-plus-lg"></i> 添加
		</button>
		<button class="btn btn-outline-success" id="mobileSaveBtn">
			<i class="bi bi-save"></i> 保存
		</button>
		<button class="btn btn-outline-info" id="mobileJsonBtn">
			<i class="bi bi-code-slash"></i> JSON
		</button>
	</div>
</div>
<div class="container py-4">
	<div class="row">
		<!-- 左侧物品列表 -->
		<div class="col-lg-4">
			<div class="card">
				<div class="card-header d-flex justify-content-between align-items-center">
					<span><i class="bi bi-list-ul me-2"></i>物品列表</span>
					<div>
						<button class="btn btn-sm btn-primary me-2" id="btnAddItem" title="添加新物品">
							<i class="bi bi-plus-lg"></i>
						</button>
						<div class="btn-group">
							<button class="btn btn-sm btn-outline-secondary" id="btnImportJson" title="导入JSON">
								<i class="bi bi-upload"></i>
							</button>
							<input type="file" id="fileInput" accept=".json" style="display: none;">
							<button class="btn btn-sm btn-outline-secondary" id="btnExportAll" title="导出所有">
								<i class="bi bi-download"></i>
							</button>
						</div>
					</div>
				</div>
				<div class="card-body">
					<div class="input-group mb-3">
						<input type="text" class="form-control" id="itemSearch" placeholder="搜索物品...">
						<button class="btn btn-outline-secondary" type="button" id="btnClearSearch">
							<i class="bi bi-x-lg"></i>
						</button>
					</div>
					<div class="item-list-container">
						<div class="item-list" id="itemList">
							<!-- 物品列表将在这里动态生成 -->
						</div>
					</div>
					<div class="d-flex justify-content-between mt-3">
						<div class="text-muted small" id="itemCount">0 个物品</div>
						<div>
							<button class="btn btn-sm btn-outline-danger me-2" id="btnClearAll">
								<i class="bi bi-trash"></i> 清空
							</button>
							<button class="btn btn-sm btn-outline-success" id="btnSaveAll">
								<i class="bi bi-cloud-arrow-up"></i> 保存
							</button>
						</div>
					</div>
				</div>
			</div>
		</div>

		<!-- 右侧物品编辑区 -->
		<div class="col-lg-8">
			<div class="card">
				<div class="card-header">
					<i class="bi bi-pencil-square me-2"></i>物品属性
				</div>
				<div class="card-body">
					<form id="itemForm">
						<input type="hidden" id="itemIndex" value="-1">

						<div class="row mb-3">
							<div class="col-md-6">
								<label for="itemId" class="form-label required-field">物品ID</label>
								<input type="text" class="form-control" id="itemId" required>
								<div class="invalid-feedback">请输入有效的物品ID</div>
							</div>
							<div class="col-md-6">
								<label for="itemName" class="form-label">物品名称</label>
								<input type="text" class="form-control" id="itemName">
							</div>
						</div>

						<div class="row mb-3">
							<div class="col-md-4">
								<label for="itemPrice" class="form-label required-field">价格</label>
								<div class="input-group">
									<span class="input-group-text"><i class="bi bi-coin"></i></span>
									<input type="number" step="0.1" class="form-control" id="itemPrice" required>
									<div class="invalid-feedback">请输入有效的价格</div>
								</div>
							</div>
							<div class="col-md-4">
								<label for="itemIcon" class="form-label">图标路径</label>
								<div class="input-group">
									<span class="input-group-text"><i class="bi bi-image"></i></span>
									<input type="text" class="form-control" id="itemIcon">
								</div>
							</div>
							<div class="col-md-4">
								<label for="itemType" class="form-label">类型</label>
								<select class="form-select" id="itemType">
									<option value="">-- 选择类型 --</option>
									<option value="weapon">武器</option>
									<option value="armor">护甲</option>
									<option value="consumable">消耗品</option>
									<option value="material">材料</option>
									<option value="quest">任务物品</option>
								</select>
							</div>
						</div>

						<div class="row mb-3">
							<div class="col-md-4">
								<label for="itemRarity" class="form-label required-field">稀有度</label>
								<select class="form-select" id="itemRarity" required>
									<option value="common">普通</option>
									<option value="uncommon">罕见</option>
									<option value="rare">稀有</option>
									<option value="epic">史诗</option>
									<option value="legendary">传说</option>
								</select>
							</div>
							<div class="col-md-4">
								<label for="itemWeight" class="form-label required-field">权重</label>
								<input type="number" class="form-control" id="itemWeight" value="10" required>
								<div class="invalid-feedback">请输入有效的权重值</div>
							</div>
							<div class="col-md-4">
								<label for="itemStackable" class="form-label">可堆叠</label>
								<select class="form-select" id="itemStackable">
									<option value="true">是</option>
									<option value="false">否</option>
								</select>
							</div>
						</div>

						<div class="mb-3">
							<label for="itemDescription" class="form-label">描述</label>
							<textarea class="form-control" id="itemDescription" rows="1"></textarea>
						</div>

						<!-- 在物品属性表单中的效果列表部分 -->
						<div class="mb-3">
							<div class="d-flex justify-content-between align-items-center mb-2">
								<h5 class="mb-0"><i class="bi bi-magic me-2"></i>效果列表</h5>
								<div>
									<button type="button" class="btn btn-sm btn-outline-primary me-2"
									        id="btnShowTemplates">
										<i class="bi bi-collection me-1"></i>效果模板库
									</button>
									<button type="button" class="btn btn-sm btn-primary" id="btnAddEffect">
										<i class="bi bi-plus-lg me-1"></i>添加效果
									</button>
								</div>
							</div>
							<div id="effectsContainer">
								<!-- 效果卡片将在这里动态生成 -->
							</div>
						</div>

						<!-- 新增的效果模板库模态框 -->
						<div class="modal fade" id="templatesModal" tabindex="-1" aria-labelledby="templatesModalLabel"
						     aria-hidden="true">
							<div class="modal-dialog modal-lg">
								<div class="modal-content">
									<div class="modal-header">
										<h5 class="modal-title" id="templatesModalLabel"><i
												class="bi bi-collection me-2"></i>效果模板库</h5>
										<button type="button" class="btn-close" data-bs-dismiss="modal"
										        aria-label="Close"></button>
									</div>
									<div class="modal-body">
										<ul class="nav nav-tabs" id="effectTemplatesTab" role="tablist">
											<li class="nav-item" role="presentation">
												<button class="nav-link active" id="modal-common-tab"
												        data-bs-toggle="tab"
												        data-bs-target="#modal-common" type="button" role="tab">常用
												</button>
											</li>
											<li class="nav-item" role="presentation">
												<button class="nav-link" id="modal-stat-tab" data-bs-toggle="tab"
												        data-bs-target="#modal-stat"
												        type="button" role="tab">属性
												</button>
											</li>
											<li class="nav-item" role="presentation">
												<button class="nav-link" id="modal-triggered-tab" data-bs-toggle="tab"
												        data-bs-target="#modal-triggered"
												        type="button" role="tab">触发
												</button>
											</li>
										</ul>
										<div class="tab-content p-3" id="effectTemplatesContent">
											<div class="tab-pane fade show active" id="modal-common" role="tabpanel">
												<div class="row">
													<div class="col-md-6 mb-3">
														<div class="card h-100 template-item"
														     data-template="damageBoost">
															<div class="card-body">
																<h5 class="card-title">伤害提升</h5>
																<p class="card-text text-muted small">增加攻击力10%</p>
															</div>
														</div>
													</div>
													<div class="col-md-6 mb-3">
														<div class="card h-100 template-item"
														     data-template="healthRegen">
															<div class="card-body">
																<h5 class="card-title">生命恢复</h5>
																<p class="card-text text-muted small">
																	每秒恢复1%最大生命值</p>
															</div>
														</div>
													</div>
													<div class="col-md-6 mb-3">
														<div class="card h-100 template-item"
														     data-template="criticalChance">
															<div class="card-body">
																<h5 class="card-title">暴击几率</h5>
																<p class="card-text text-muted small">增加5%暴击率</p>
															</div>
														</div>
													</div>
												</div>
											</div>
											<div class="tab-pane fade" id="modal-stat" role="tabpanel">
												<div class="row">
													<div class="col-md-6 mb-3">
														<div class="card h-100 template-item"
														     data-template="statAttack">
															<div class="card-body">
																<h5 class="card-title">攻击力提升</h5>
																<p class="card-text text-muted small">基础攻击力增加</p>
															</div>
														</div>
													</div>
													<div class="col-md-6 mb-3">
														<div class="card h-100 template-item"
														     data-template="statDefense">
															<div class="card-body">
																<h5 class="card-title">防御力提升</h5>
																<p class="card-text text-muted small">基础防御力增加</p>
															</div>
														</div>
													</div>
													<div class="col-md-6 mb-3">
														<div class="card h-100 template-item" data-template="statSpeed">
															<div class="card-body">
																<h5 class="card-title">移动速度提升</h5>
																<p class="card-text text-muted small">
																	基础移动速度增加</p>
															</div>
														</div>
													</div>
												</div>
											</div>
											<div class="tab-pane fade" id="modal-triggered" role="tabpanel">
												<div class="row">
													<div class="col-md-6 mb-3">
														<div class="card h-100 template-item"
														     data-template="onHitEffect">
															<div class="card-body">
																<h5 class="card-title">受伤触发</h5>
																<p class="card-text text-muted small">
																	受伤时30%几率反击</p>
															</div>
														</div>
													</div>
													<div class="col-md-6 mb-3">
														<div class="card h-100 template-item"
														     data-template="onKillEffect">
															<div class="card-body">
																<h5 class="card-title">击杀触发</h5>
																<p class="card-text text-muted small">
																	击杀敌人时恢复生命</p>
															</div>
														</div>
													</div>
													<div class="col-md-6 mb-3">
														<div class="card h-100 template-item"
														     data-template="onCriticalEffect">
															<div class="card-body">
																<h5 class="card-title">暴击触发</h5>
																<p class="card-text text-muted small">
																	暴击时造成额外伤害</p>
															</div>
														</div>
													</div>
												</div>
											</div>
										</div>
									</div>
									<div class="modal-footer">
										<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">关闭
										</button>
									</div>
								</div>
							</div>
						</div>


						<div class="d-flex justify-content-between mt-4">
							<div>
								<button type="button" class="btn btn-danger me-2" id="btnDeleteItem">
									<i class="bi bi-trash me-1"></i>删除物品
								</button>
								<button type="button" class="btn btn-outline-secondary" id="btnDuplicateItem">
									<i class="bi bi-copy me-1"></i>复制物品
								</button>
							</div>
							<button type="submit" class="btn btn-success">
								<i class="bi bi-check-circle me-1"></i>保存物品
							</button>
						</div>
					</form>
				</div>
			</div>

			<div class="card mt-4">
				<div class="card-header d-flex justify-content-between align-items-center">
					<div>
						<i class="bi bi-code-slash me-2"></i>JSON编辑器
					</div>
					<button class="btn btn-sm btn-outline-primary" type="button" data-bs-toggle="collapse"
					        data-bs-target="#jsonEditorCollapse">
						<i class="bi bi-chevron-down"></i> 展开/收起
					</button>
				</div>
				<div class="collapse" id="jsonEditorCollapse">
					<div class="card-body">
						<ul class="nav nav-tabs" id="jsonTabs" role="tablist">
							<li class="nav-item" role="presentation">
								<button class="nav-link active" id="current-item-tab" data-bs-toggle="tab"
								        data-bs-target="#current-item" type="button" role="tab">当前物品
								</button>
							</li>
							<li class="nav-item" role="presentation">
								<button class="nav-link" id="preview-tab" data-bs-toggle="tab"
								        data-bs-target="#preview" type="button" role="tab">全部物品
								</button>
							</li>
							<li class="nav-item" role="presentation">
								<button class="nav-link" id="editor-tab" data-bs-toggle="tab" data-bs-target="#editor"
								        type="button" role="tab">编辑器
								</button>
							</li>
							<li class="nav-item" role="presentation">
								<button class="nav-link" id="validation-tab" data-bs-toggle="tab"
								        data-bs-target="#validation" type="button" role="tab">验证
								</button>
							</li>
						</ul>
						<div class="tab-content" id="jsonTabContent">
							<div class="tab-pane fade show active" id="current-item" role="tabpanel">
                    <textarea id="currentItemJson" class="json-editor mb-3" placeholder="当前物品JSON..."
                              readonly></textarea>
								<div class="d-flex justify-content-between">
									<div>
										<button class="btn btn-primary me-2" id="btnCopyCurrentJson">
											<i class="bi bi-clipboard me-1"></i>复制JSON
										</button>
										<button class="btn btn-secondary" id="btnDownloadCurrentJson">
											<i class="bi bi-download me-1"></i>下载JSON
										</button>
									</div>
								</div>
							</div>
							<div class="tab-pane fade" id="preview" role="tabpanel">
                    <textarea id="jsonOutput" class="json-editor mb-3" placeholder="所有物品JSON..."
                              readonly></textarea>
								<div class="d-flex justify-content-between">
									<div>
										<button class="btn btn-primary me-2" id="btnCopyJson">
											<i class="bi bi-clipboard me-1"></i>复制JSON
										</button>
										<button class="btn btn-secondary" id="btnDownloadJson">
											<i class="bi bi-download me-1"></i>下载JSON
										</button>
									</div>
									<button class="btn btn-outline-success" id="btnUpdateFromJson">
										<i class="bi bi-arrow-clockwise me-1"></i>从JSON更新
									</button>
								</div>
							</div>
							<div class="tab-pane fade" id="editor" role="tabpanel">
                    <textarea id="jsonEditor" class="json-editor mb-3"
                              placeholder="在此编辑JSON..."></textarea>
								<div class="d-flex justify-content-between">
									<button class="btn btn-primary" id="btnFormatJson">
										<i class="bi bi-align-left me-1"></i>格式化
									</button>
									<div>
										<button class="btn btn-success me-2" id="btnApplyJson">
											<i class="bi bi-check-circle me-1"></i>应用更改
										</button>
										<button class="btn btn-outline-secondary" id="btnRevertJson">
											<i class="bi bi-arrow-counterclockwise me-1"></i>撤销更改
										</button>
									</div>
								</div>
							</div>
							<div class="tab-pane fade" id="validation" role="tabpanel">
								<div class="alert alert-info">
									<i class="bi bi-info-circle me-2"></i>JSON验证结果将显示在这里
								</div>
								<div id="validationResults"></div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<!-- 帮助模态框 -->
<div class="modal fade" id="helpModal" tabindex="-1" aria-labelledby="helpModalLabel" aria-hidden="true">
	<div class="modal-dialog modal-lg">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="helpModalLabel"><i class="bi bi-question-circle me-2"></i>帮助文档</h5>
				<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
			</div>
			<div class="modal-body">
				<h5>物品属性说明</h5>
				<ul>
					<li><strong>物品ID</strong>: 唯一标识符，只能包含字母、数字和下划线</li>
					<li><strong>价格</strong>: 物品的基础价格，可以是小数</li>
					<li><strong>稀有度</strong>: 决定物品的颜色和获取难度</li>
					<li><strong>权重</strong>: 影响物品在掉落池中的出现概率</li>
				</ul>

				<h5 class="mt-4">效果类型</h5>
				<div class="table-responsive">
					<table class="table table-bordered">
						<thead>
						<tr>
							<th>类型</th>
							<th>描述</th>
							<th>示例</th>
						</tr>
						</thead>
						<tbody>
						<tr>
							<td>属性修改</td>
							<td>直接修改角色属性</td>
							<td>攻击力+10%</td>
						</tr>
						<tr>
							<td>触发效果</td>
							<td>在特定事件发生时触发</td>
							<td>暴击时30%几率造成双倍伤害</td>
						</tr>
						</tbody>
					</table>
				</div>

				<h5 class="mt-4">快捷键</h5>
				<ul>
					<li><kbd>Ctrl+S</kbd>: 保存当前物品</li>
					<li><kbd>Ctrl+N</kbd>: 新建物品</li>
					<li><kbd>Ctrl+D</kbd>: 复制当前物品</li>
					<li><kbd>Ctrl+E</kbd>: 添加新效果</li>
				</ul>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-primary" data-bs-dismiss="modal">关闭</button>
			</div>
		</div>
	</div>
</div>

<!-- 确认删除模态框 -->
<div class="modal fade" id="confirmDeleteModal" tabindex="-1" aria-labelledby="confirmDeleteModalLabel"
     aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header bg-danger text-white">
				<h5 class="modal-title" id="confirmDeleteModalLabel"><i class="bi bi-exclamation-triangle me-2"></i>确认删除
				</h5>
				<button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
				        aria-label="Close"></button>
			</div>
			<div class="modal-body">
				<p>您确定要删除此物品吗？此操作无法撤销。</p>
				<p class="text-muted">物品ID: <span id="deleteItemId"></span></p>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
				<button type="button" class="btn btn-danger" id="btnConfirmDelete">确认删除</button>
			</div>
		</div>
	</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
	// =============================================
	// 全局变量和配置
	// =============================================

	// 游戏物品数据
	let items = [];
	let currentEffectIndex = -1;
	let currentItemIndex = -1;
	let historyStack = [];
	let historyPointer = -1;
	// 在全局变量部分添加
	let isEditingEffect = false;
	let currentEditingEffectIndex = -1;

	// 本地存储键
	const STORAGE_KEY = 'advanced_game_items_designer_data';

	// 效果参数字段池
	const effectFieldsPool = {
		// 数值类参数
		statRatio: {type: 'number', label: '增加比例', step: 0.01, value: 0.1, min: -10, max: 10},
		ownerRatio: {type: 'number', label: '持有属性转换比例', step: 0.01, value: 0.1, min: -10, max: 10},
		otherStatRatio: {type: 'number', label: '转换属性比例', step: 0.01, value: 0.1, min: -10, max: 10},
		statLimitRatio: {type: 'number', label: '突破上限比例', step: 0.01, value: 0.1, min: 0, max: 10},
		triggerChance: {type: 'number', label: '触发几率', step: 0.01, min: 0, max: 1, value: 0.3},
		bulletCounts: {type: 'number', label: '子弹数量', step: 1, value: 1, min: 1, max: 100},
		bulletPenetrate: {type: 'number', label: '穿透次数', step: 1, value: 1, min: 0, max: 10},
		baseDamage: {type: 'number', label: '基础伤害', step: 1, value: 10, min: 0},
		attackAmount: {type: 'number', label: '攻击目标数', step: 1, value: 1, min: 1, max: 10},

		// 属性选择类
		stat: {
			type: 'select',
			label: '属性名称',
			options: [
				{value: 'Ack', text: '攻击力'},
				{value: 'MaxHp', text: '最大生命值'},
				{value: 'Def', text: '防御力'},
				{value: 'AttacksPerSecond', text: '攻击速度'},
				{value: 'Critical', text: '暴击率'},
				{value: 'CriticalDamage', text: '暴击伤害'},
				{value: 'LifeSteal', text: '生命偷取'},
				{value: 'HpRecover', text: '生命恢复'},
				{value: 'Speed', text: '移动速度'},
				{value: 'Lucky', text: '幸运值'},
				{value: 'Dodge', text: '闪避率'},
				{value: 'CloseDamage', text: '近战伤害'},
				{value: 'RemoteDamage', text: '远程伤害'}
			]
		},
		addStat: {
			type: 'select',
			label: '需要增加的属性',
			options: [
				{value: 'Ack', text: '攻击力'},
				{value: 'MaxHp', text: '最大生命值'},
				{value: 'Def', text: '防御力'},
				{value: 'AttacksPerSecond', text: '攻击速度'},
				{value: 'Critical', text: '暴击率'},
				{value: 'CriticalDamage', text: '暴击伤害'},
				{value: 'LifeSteal', text: '生命偷取'},
				{value: 'HpRecover', text: '生命恢复'},
				{value: 'Speed', text: '移动速度'},
				{value: 'Lucky', text: '幸运值'},
				{value: 'Dodge', text: '闪避率'},
				{value: 'CloseDamage', text: '近战伤害'},
				{value: 'RemoteDamage', text: '远程伤害'},
				{value: 'TmpAck', text: '临时攻击力'},
				{value: 'TmpDef', text: '临时防御力'},
				{value: 'TmpSpeed', text: '临时移动速度'}
			]
		},
		ownerStat: {
			type: 'select',
			label: '持有属性',
			options: [
				{value: 'Ack', text: '攻击力'},
				{value: 'MaxHp', text: '最大生命值'},
				{value: 'Def', text: '防御力'},
				{value: 'AttacksPerSecond', text: '攻击速度'},
				{value: 'Critical', text: '暴击率'},
				{value: 'CriticalDamage', text: '暴击伤害'},
				{value: 'LifeSteal', text: '生命偷取'},
				{value: 'HpRecover', text: '生命恢复'},
				{value: 'Speed', text: '移动速度'},
				{value: 'Lucky', text: '幸运值'},
				{value: 'Dodge', text: '闪避率'},
				{value: 'CloseDamage', text: '近战伤害'},
				{value: 'RemoteDamage', text: '远程伤害'},
			]
		},
		otherAddStat: {
			type: 'select',
			label: '转换属性',
			options: [
				{value: 'Ack', text: '攻击力'},
				{value: 'MaxHp', text: '最大生命值'},
				{value: 'Def', text: '防御力'},
				{value: 'AttacksPerSecond', text: '攻击速度'},
				{value: 'Critical', text: '暴击率'},
				{value: 'CriticalDamage', text: '暴击伤害'},
				{value: 'LifeSteal', text: '生命偷取'},
				{value: 'HpRecover', text: '生命恢复'},
				{value: 'Speed', text: '移动速度'},
				{value: 'Lucky', text: '幸运值'},
				{value: 'Dodge', text: '闪避率'},
				{value: 'CloseDamage', text: '近战伤害'},
				{value: 'RemoteDamage', text: '远程伤害'},
			]
		},
		addGameStat: {
			type: 'select',
			label: '需要增加的全局属性',
			options: [
				{value: 'GlobalGold', text: '当前金币'},
				{value: 'CurrentLevel', text: '当前等级'},
			]
		},
		statLimit: {
			type: 'select',
			label: '突破属性上限',
			options: [
				{value: 'SpeedMax', text: '速度上限'},
				{value: 'DodgeMax', text: '闪避上限'},
			]
		},
		bulletType: {
			type: 'select',
			label: '子弹类型',
			options: [
				{value: 'Common', text: '普通'},
				{value: 'Explode', text: '爆炸'},
				{value: 'Pierce', text: '穿透'}
			]
		},
		operation: {
			type: 'select',
			label: '操作类型',
			options: [
				{value: 'add', text: '+'},
				{value: 'subtract', text: '-'},
				{value: 'multiply', text: '*'}
			]
		},
		isCritical: {
			type: 'select',
			label: '能否暴击',
			options: [
				{value: 'true', text: '可以暴击'},
				{value: 'false', text: '不能暴击'}
			]
		},
		compares: {
			type: 'select',
			label: '什么时候条件成立',
			options: [
				{value: 'true', text: '<'},
				{value: 'false', text: '>'}
			]
		},
		threshold: {
			type: 'number',
			label: '条件阈值',
			step: '0.1',
			value: 0.1
		},
		value: {
			type: 'number',
			label: '数值',
			step: '0.1',
			value: 0.1
		},
		xSecond: {
			type: 'number',
			label: '秒',
			step: '0.1',
			value: 0.1
		},
		xSecondCount: {
			type: 'number',
			label: '次数',
			step: '1',
			value: 1
		},
		bulletBehaviors: {
			type: 'nested',
			label: '子弹行为',
			multiple: true,
			fields: [
				{
					type: 'select',
					label: '行为类型',
					param: 'type', // 明确指定参数名
					options: [
						{value: 'Freezing', text: '冰冻'},
						{value: 'Burn', text: '燃烧'},
						{value: 'Poison', text: '中毒'},
						{value: 'Bleed', text: '流血'}
					]
				},
				{
					type: 'text',
					label: 'id',
					value: 1,
					param: 'effectId',
					placeholder: '输入唯一效果ID',
				},
				{
					type: 'number',
					label: '最大层数',
					param: 'maxStacks',
					min: 1,
					max: 10,
					value: 1
				},
				{
					type: 'number',
					label: '每层效果值',
					param: 'valuePerStack',
					step: 0.1,
					value: 1
				},
				{
					type: 'number',
					label: '持续时间(秒)',
					param: 'durationPerStack',
					step: 0.1,
					value: 1
				}
			]
		},
		specialEventTypes: {
			type: 'select',
			label: '触发类型',
			options: [
				{value: 'OnWaveStart', text: '波次开始时'},
				{value: 'OnWaveEnd', text: '波次结束时'},
				{value: 'OnHit', text: '受伤时'},
				{value: 'OnKill', text: '击杀敌人时'},
				{value: 'OnPickupMaterial', text: '拾取材料时'},
				{value: 'OnCritical', text: '暴击时'},
				{value: 'OnDodge', text: '闪避时'},
				{value: 'OnSecond', text: '每秒'},
				{value: 'OnHpChange', text: '血量变化时'},
				{value: 'OnHalfHealth', text: '半血时'},
				{value: 'OnSpeedChange', text: '移速变化时'},
				{value: 'OnShopApply', text: '购买时生效'},
				{value: 'OnStatChange', text: '属性变化时'},
			]
		}
	};

	// 效果参数结构定义
	const effectParams = {
		stat: {
			required: ['stat', 'value'],
			optional: ['operation']
		},
		triggered: {
			baseParams: {
				required: ['specialEventTypes'],
				optional: ['triggerChance']
			},
			typeParams: {
				CriticalDouble: {required: ['triggerChance']},
				CriticalHpRecover: {required: ['triggerChance']},
				CriticalPercentage: {required: ['triggerChance']},
				DodgeHpRecover: {required: ['triggerChance']},
				DodgeRebound: {required: ['triggerChance']},
				FullHealthHpRecover: {required: ['isCritical', 'attackAmount', 'bulletBehaviors']},
				ThresholdHpAddStat: {required: ['compares', 'threshold', 'addStat', 'statRatio']},
				HitExplode: {
					required: ['addStat', 'statRatio', 'bulletType'],
					optional: ['bulletCounts', 'bulletPenetrate']
				},
				HitTemporary: {required: ['addStat', 'statRatio']},
				KillPickMaterial: {required: ['triggerChance']},
				KillAddStat: {required: ['addStat', 'statRatio', 'triggerChance']},
				KillEnemyToDamage: {
					required: ['baseDamage', 'addStat', 'statRatio', 'triggerChance'],
					optional: ['attackAmount', 'isCritical']
				},
				KillPackedScene: {
					required: ['addStat', 'statRatio', 'triggerChance', 'bulletType'],
					optional: ['bulletCounts', 'bulletType']
				},
				PickAddStat: {required: ['addStat', 'statRatio', 'triggerChance']},
				PickDouble: {required: ['triggerChance']},
				PickExplode: {
					required: ['bulletType', 'triggerChance', 'addStat', 'statRatio'],
					optional: ['bulletCounts']
				},
				PickHpRecover: {required: ['triggerChance']},
				SecondHpRecover: {required: ['recover', 'xSecond']},
				SecondHurt: {required: ['baseDamage', 'xSecond']},
				FreeFlushCount: {required: ['xSecondCount']},
				BulletLaunch: {required: ['xSecondCount']},
				SecondPackedScene: {
					required: ['xSecond', 'addStat', 'statRatio', 'triggerChance', 'bulletCounts'],
					optional: ['bulletBehaviors']
				},
				SecondTmpChange: {required: ['addStat', 'statRatio', 'triggerChance']},
				StandTmpChange: {required: ['addStat', 'statRatio']},
				WaveEndAddStat: {required: ['addStat', 'statRatio']},
				WaveEndGameConfig: {required: ['addGameStat', 'statRatio']},
				WaveImmune: {required: []},
				WaveFreeFlush: {required: []},
				WaveTemporary: {required: ['addStat', 'statRatio']},
				StatLimitChange: {required: ['statLimit', 'statLimitRatio']},
				StatChangeOther: {required: ['ownerStat', 'ownerRatio', 'otherAddStat', 'otherStatRatio']}
			}
		}
	};

	// 效果类型映射
	const effectTypeMap = {
		'OnWaveStart': [
			{value: 'WaveTemporary', text: '改变临时属性'},
			{value: 'WaveImmune', text: '抵挡一次伤害'},
			{value: 'WaveFreeFlush', text: '每回合获得一次免费刷新'}
		],
		'OnHit': [
			{value: 'HitExplode', text: '产生爆炸'},
			{value: 'HitTmpChange', text: '改变临时属性'}
		],
		'OnKill': [
			{value: 'KillAddStat', text: '永久增加自身属性'},
			{value: 'KillEnemyToDamage', text: '对其他敌人造成伤害'},
			{value: 'KillPackedScene', text: '生成子弹'},
			{value: 'KillPickMaterial', text: '拾取掉落物'}
		],
		'OnPickupMaterial': [
			{value: 'PickAddStat', text: '永久增加属性'},
			{value: 'PickHpRecover', text: '回复生命'},
			{value: 'PickDouble', text: '使材料价值翻倍'},
			{value: 'PickExplode', text: '产生爆炸'}
		],
		'OnCritical': [
			{value: 'CriticalDouble', text: '材料掉落翻倍'},
			{value: 'CriticalHpRecover', text: '回复生命'},
			{value: 'CriticalPercentage', text: '对敌人造成额外的百分比伤害'}
		],
		'OnDodge': [
			{value: 'DodgeRebound', text: '反击敌人'},
			{value: 'DodgeHpRecover', text: '回复生命'}
		],
		'OnSecond': [
			{value: 'SecondHurt', text: '受到伤害'},
			{value: 'SecondHpRecover', text: '回复生命'},
			{value: 'SecondPackedScene', text: '生成子弹'},
			{value: 'SecondTmpChange', text: '改变临时属性'}
		],
		'OnHpChange': [
			{value: 'FullHealthHpRecover', text: '溢出的生命再生会对敌人造成伤害'},
			{value: 'ThresholdHpAddStat', text: '血量到达某个阈值时改变临时属性'}
		],
		'OnWaveEnd': [
			{value: 'WaveEndAddStat', text: '永久增加属性'},
			{value: 'WaveEndGameConfig', text: '增加经济/经验'}
		],
		'OnHalfHealth': [
			{value: 'WaveEndAddStat', text: '永久增加属性'},
			{value: 'WaveEndGameConfig', text: '增加经济/经验'}
		],
		'OnSpeedChange': [
			{value: 'StandTmpChange', text: '站立不动时增加属性'},
		],
		'OnShopApply': [
			{value: 'StatLimitChange', text: '属性上限突破'},
			{value: 'FreeFlushCount', text: '获得x次免费刷新'},
			{value: 'BulletLaunch', text: '获得x次子弹弹射'},
		],
		'OnStatChange': [
			{value: 'StatChangeOther', text: '属性转换'},
		]
	};

	// 模板效果
	const effectTemplates = {
		damageBoost: {
			stat: 'Ack',
			value: 0.1,
			operation: 'add'
		},
		healthRegen: {
			effect: 'Triggered',
			specialEventTypes: 'OnSecond',
			type: 'SecondHpRecover',
			statRatio: 0.01,
			xSecond: 1
		},
		criticalChance: {
			stat: 'Critical',
			value: 0.05,
			operation: 'add'
		},
		statAttack: {
			stat: 'Ack',
			value: 10,
			operation: 'add'
		},
		statDefense: {
			stat: 'Def',
			value: 10,
			operation: 'add'
		},
		statSpeed: {
			stat: 'Speed',
			value: 0.1,
			operation: 'add'
		},
		onHitEffect: {
			effect: 'Triggered',
			specialEventTypes: 'OnHit',
			type: 'HitExplode',
			triggerChance: 0.3,
			bulletType: 'Common',
			bulletCounts: 1
		},
		onKillEffect: {
			effect: 'Triggered',
			specialEventTypes: 'OnKill',
			type: 'KillAddStat',
			addStat: 'MaxHp',
			statRatio: 0.05,
			triggerChance: 1
		},
		onCriticalEffect: {
			effect: 'Triggered',
			specialEventTypes: 'OnCritical',
			type: 'CriticalDouble',
			triggerChance: 1
		}
	};
	// DOM加载完成后初始化
	document.addEventListener('DOMContentLoaded', function ()
	{
		// 初始化工具提示
		initTooltips();

		// 从本地存储加载数据
		loadFromLocalStorage();

		// 初始化事件监听
		initEventListeners();

		// 初始化快捷键
		initShortcuts();

		// 如果没有物品，添加一个默认物品
		if(items.length === 0)
		{
			addNewItem();
		}
		else
		{
			// 有数据则渲染第一个物品
			editItem(0);
		}

		// 更新物品计数
		updateItemCount();

		// 添加触摸设备检测
		function isTouchDevice()
		{
			return 'ontouchstart' in window || navigator.maxTouchPoints;
		}

		if(isTouchDevice())
		{
			// 为触摸设备添加特定类
			document.body.classList.add('is-touch-device');

			// 调整物品列表项点击区域
			document.querySelectorAll('.item-list-item').forEach(item =>
			{
				item.style.padding = '15px';
				item.style.minHeight = '60px';
			});

			// 增大效果操作按钮尺寸
			document.querySelectorAll('.effect-actions .btn').forEach(btn =>
			{
				btn.style.padding = '10px';
				btn.style.fontSize = '1.1rem';
			});
		}

		// 防止移动设备上的双击缩放干扰点击事件
		let lastTouchTime = 0;
		document.addEventListener('touchend', function (event)
		{
			const now = Date.now();
			if(now - lastTouchTime < 300)
			{
				event.preventDefault();
			}
			lastTouchTime = now;
		}, false);
	});

	// 初始化工具提示
	function initTooltips()
	{
		const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
		tooltipTriggerList.map(function (tooltipTriggerEl)
		{
			return new bootstrap.Tooltip(tooltipTriggerEl);
		});
	}

	// 初始化事件监听
	function initEventListeners()
	{

		// 添加物品按钮
		document.getElementById('btnAddItem').addEventListener('click', addNewItem);

		// 保存物品表单
		document.getElementById('itemForm').addEventListener('submit', saveItem);

		// 删除物品按钮
		document.getElementById('btnDeleteItem').addEventListener('click', showDeleteConfirmation);

		// 确认删除按钮
		document.getElementById('btnConfirmDelete').addEventListener('click', deleteCurrentItem);

		// 复制物品按钮
		document.getElementById('btnDuplicateItem').addEventListener('click', duplicateCurrentItem);

		// 添加效果按钮
		document.getElementById('btnAddEffect').addEventListener('click', function ()
		{
			currentEffectIndex = -1; // 表示是新效果
			showEffectForm();
		});

		// 复制JSON按钮
		document.getElementById('btnCopyJson').addEventListener('click', copyJsonToClipboard);

		// 下载JSON按钮
		document.getElementById('btnDownloadJson').addEventListener('click', downloadJson);

		// 导入JSON按钮
		document.getElementById('btnImportJson').addEventListener('click', function ()
		{
			document.getElementById('fileInput').click();
		});

		// 导出所有按钮
		document.getElementById('btnExportAll').addEventListener('click', exportAllItems);

		// 文件输入变化
		document.getElementById('fileInput').addEventListener('change', handleFileImport);

		// 从JSON更新按钮
		document.getElementById('btnUpdateFromJson').addEventListener('click', updateFromJson);

		// 格式化JSON按钮
		document.getElementById('btnFormatJson').addEventListener('click', formatJson);

		// 应用JSON更改按钮
		document.getElementById('btnApplyJson').addEventListener('click', applyJsonChanges);

		// 撤销JSON更改按钮
		document.getElementById('btnRevertJson').addEventListener('click', revertJsonChanges);

		// 清空所有按钮
		document.getElementById('btnClearAll').addEventListener('click', clearAllItems);

		// 保存所有按钮
		document.getElementById('btnSaveAll').addEventListener('click', saveAllItems);

		// 搜索框输入事件
		document.getElementById('itemSearch').addEventListener('input', searchItems);

		// 清空搜索按钮
		document.getElementById('btnClearSearch').addEventListener('click', clearSearch);

		document.getElementById('btnShowTemplates').addEventListener('click', function ()
		{
			const modal = new bootstrap.Modal(document.getElementById('templatesModal'));
			modal.show();
		});

		document.querySelectorAll('.template-item').forEach(item =>
		{
			item.addEventListener('click', function ()
			{
				const templateName = this.dataset.template;
				applyEffectTemplate(templateName);

				// 关闭模态框
				const modal = bootstrap.Modal.getInstance(document.getElementById('templatesModal'));
				modal.hide();
			});
		});

		// 表单字段变化时自动保存
		document.getElementById('itemForm').addEventListener('input', function ()
		{
			if(currentItemIndex !== -1)
			{
				autoSaveItem();
			}
		});

		// JSON文本区域变化时
		document.getElementById('jsonOutput').addEventListener('input', function ()
		{
			// 可以在这里添加实时验证逻辑
		});

	}

	// 初始化快捷键
	function initShortcuts()
	{
		document.addEventListener('keydown', function (e)
		{
			// Ctrl+S - 保存当前物品
			if(e.ctrlKey && e.key === 's')
			{
				e.preventDefault();
				saveItem();
			}

			// Ctrl+N - 新建物品
			if(e.ctrlKey && e.key === 'n')
			{
				e.preventDefault();
				addNewItem();
			}

			// Ctrl+D - 复制当前物品
			if(e.ctrlKey && e.key === 'd')
			{
				e.preventDefault();
				duplicateCurrentItem();
			}

			// Ctrl+E - 添加新效果
			if(e.ctrlKey && e.key === 'e')
			{
				e.preventDefault();
				currentEffectIndex = -1;
				showEffectForm();
			}
		});
	}

	// =============================================
	// 核心功能函数
	// =============================================

	// 从本地存储加载数据
	function loadFromLocalStorage()
	{
		const savedData = localStorage.getItem(STORAGE_KEY);
		if(savedData)
		{
			try
			{
				items = JSON.parse(savedData);
				updateJsonPreview();
			} catch (e)
			{
				console.error('解析本地存储数据失败:', e);
				items = [];
			}
		}
	}

	// 保存数据到本地存储
	function saveToLocalStorage()
	{
		localStorage.setItem(STORAGE_KEY, JSON.stringify(items));
	}

	// 添加新物品
	function addNewItem()
	{
		const newItem = {
			id: "item_" + Date.now(),
			name: "新物品",
			price: 0,
			icon: "",
			type: "",
			rarity: "common",
			weight: 10,
			stackable: true,
			description: "",
			effects: []
		};

		items.push(newItem);
		saveToHistory('添加新物品');
		renderItemList();
		editItem(items.length - 1);
		updateJsonPreview();
		updateItemCount();
	}

	// 渲染物品列表
	function renderItemList()
	{
		const itemList = document.getElementById('itemList');
		itemList.innerHTML = '';

		if(items.length === 0)
		{
			itemList.innerHTML = '<div class="text-muted text-center py-4">暂无物品</div>';
			return;
		}

		items.forEach((item, index) =>
		{
			const itemElement = document.createElement('div');
			itemElement.className = `item-list-item ${index === currentItemIndex ? 'active' : ''}`;

			// 根据稀有度设置徽章类
			let badgeClass = 'badge-common';
			if(item.rarity === 'uncommon') badgeClass = 'badge-uncommon';
			else if(item.rarity === 'rare') badgeClass = 'badge-rare';
			else if(item.rarity === 'epic') badgeClass = 'badge-epic';
			else if(item.rarity === 'legendary') badgeClass = 'badge-legendary';

			itemElement.innerHTML = `
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <strong>${item.name || item.id}</strong>
                        <span class="badge ${badgeClass} ms-2">${getRarityName(item.rarity)}</span>
                    </div>
                    <div class="text-end">
                        <small class="text-muted">${item.type || '无类型'}</small>
                    </div>
                </div>
                <div class="item-meta mt-1">
                    <span>ID: ${item.id}</span>
                    <span class="ms-2">价格: ${item.price}</span>
                    <span class="ms-2">权重: ${item.weight}</span>
                </div>
            `;

			itemElement.addEventListener('click', () => editItem(index));
			itemList.appendChild(itemElement);
		});
	}

	// 获取稀有度名称
	function getRarityName(rarity)
	{
		const names = {
			'common': '普通',
			'uncommon': '罕见',
			'rare': '稀有',
			'epic': '史诗',
			'legendary': '传说'
		};
		return names[rarity] || rarity;
	}

	// 编辑物品
	function editItem(index)
	{
		if(index < 0 || index >= items.length) return;

		const item = items[index];
		currentItemIndex = index;

		document.getElementById('itemIndex').value = index;
		document.getElementById('itemId').value = item.id;
		document.getElementById('itemName').value = item.name || '';
		document.getElementById('itemPrice').value = item.price;
		document.getElementById('itemIcon').value = item.icon;
		document.getElementById('itemType').value = item.type;
		document.getElementById('itemRarity').value = item.rarity;
		document.getElementById('itemWeight').value = item.weight;
		document.getElementById('itemStackable').value = item.stackable !== false ? 'true' : 'false';
		document.getElementById('itemDescription').value = item.description || '';

		// 渲染效果列表
		renderEffects(item.effects);
		renderItemList(); // 更新列表中的活动项样式
		updateJsonPreview();
	}

	// 自动保存物品（表单字段变化时调用）
	function autoSaveItem()
	{
		const index = parseInt(document.getElementById('itemIndex').value);
		if(index === -1) return;

		items[index] = {
			...items[index],
			id: document.getElementById('itemId').value,
			name: document.getElementById('itemName').value,
			price: parseFloat(document.getElementById('itemPrice').value),
			icon: document.getElementById('itemIcon').value,
			type: document.getElementById('itemType').value,
			rarity: document.getElementById('itemRarity').value,
			weight: parseInt(document.getElementById('itemWeight').value),
			stackable: document.getElementById('itemStackable').value === 'true',
			description: document.getElementById('itemDescription').value
		};

		saveToHistory('修改物品属性');
		renderItemList();
		updateJsonPreview();
	}

	function saveItem(e)
	{
		if(e)
		{
			e.preventDefault(); // 阻止表单默认提交行为
		}

		const index = parseInt(document.getElementById('itemIndex').value);
		if(index === -1)
		{
			showToast('请先选择要保存的物品', 'warning');
			return;
		}

		// 验证表单
		if(!validateItemForm())
		{
			showToast('请正确填写所有必填字段', 'danger');
			return;
		}
		// 保存数据
		items[index] = {
			...items[index],
			id: document.getElementById('itemId').value,
			name: document.getElementById('itemName').value,
			price: parseFloat(document.getElementById('itemPrice').value),
			icon: document.getElementById('itemIcon').value,
			type: document.getElementById('itemType').value,
			rarity: document.getElementById('itemRarity').value,
			weight: parseInt(document.getElementById('itemWeight').value),
			stackable: document.getElementById('itemStackable').value === 'true',
			description: document.getElementById('itemDescription').value
		};
		saveToHistory('修改物品属性');
		saveToLocalStorage(); // 确保保存到本地存储
		renderItemList();
		updateJsonPreview();
		showToast('物品保存成功', 'success');
	}

	// 验证物品表单
	function validateItemForm()
	{
		let isValid = true;
		// 验证物品ID
		const itemId = document.getElementById('itemId');
		if(!itemId.value.trim())
		{
			itemId.classList.add('is-invalid');
			isValid = false;
		}
		else
		{
			itemId.classList.remove('is-invalid');
		}

		// 验证价格
		const itemPrice = document.getElementById('itemPrice');
		if(isNaN(parseFloat(itemPrice.value)))
		{
			itemPrice.classList.add('is-invalid');
			isValid = false;
		}
		else
		{
			itemPrice.classList.remove('is-invalid');
		}

		// 验证权重
		const itemWeight = document.getElementById('itemWeight');
		if(isNaN(parseInt(itemWeight.value)))
		{
			itemWeight.classList.add('is-invalid');
			isValid = false;
		}
		else
		{
			itemWeight.classList.remove('is-invalid');
		}

		return isValid;
	}

	// 显示删除确认对话框
	function showDeleteConfirmation()
	{
		const index = parseInt(document.getElementById('itemIndex').value);
		if(index === -1) return;

		const item = items[index];
		document.getElementById('deleteItemId').textContent = item.id;

		const modal = new bootstrap.Modal(document.getElementById('confirmDeleteModal'));
		modal.show();
	}

	// 删除当前物品
	function deleteCurrentItem()
	{
		const index = parseInt(document.getElementById('itemIndex').value);
		if(index === -1) return;

		const itemId = items[index].id;
		items.splice(index, 1);
		saveToHistory(`删除物品: ${itemId}`);
		saveToLocalStorage();
		renderItemList();
		updateItemCount();

		if(items.length > 0)
		{
			editItem(Math.min(index, items.length - 1));
		}
		else
		{
			addNewItem();
		}

		const modal = bootstrap.Modal.getInstance(document.getElementById('confirmDeleteModal'));
		modal.hide();

		showToast('物品已删除', 'warning');
	}

	// 复制当前物品
	function duplicateCurrentItem()
	{
		const index = parseInt(document.getElementById('itemIndex').value);
		if(index === -1) return;

		const originalItem = items[index];
		const newItem = JSON.parse(JSON.stringify(originalItem));
		newItem.id = newItem.id + '_copy_' + Date.now();
		newItem.name = (newItem.name || '') + ' (副本)';

		items.push(newItem);
		saveToHistory(`复制物品: ${originalItem.id}`);
		renderItemList();
		editItem(items.length - 1);
		updateJsonPreview();
		updateItemCount();

		showToast('物品已复制', 'success');
	}

	// 清空所有物品
	function clearAllItems()
	{
		if(items.length === 0 || !confirm('确定要清空所有物品吗？此操作不可撤销！'))
		{
			return;
		}

		saveToHistory('清空所有物品');
		items = [];
		saveToLocalStorage();
		renderItemList();
		updateJsonPreview();
		updateItemCount();
		addNewItem();

		showToast('已清空所有物品', 'danger');
	}

	// 保存所有物品
	function saveAllItems()
	{
		saveToLocalStorage();
		showToast('所有物品已保存', 'success');
	}

	// 更新物品计数显示
	function updateItemCount()
	{
		document.getElementById('itemCount').textContent = `${items.length} 个物品`;
	}

	// 搜索物品
	function searchItems()
	{
		const searchTerm = document.getElementById('itemSearch').value.toLowerCase();
		if(!searchTerm)
		{
			renderItemList();
			return;
		}

		const filteredItems = items.filter(item =>
				item.id.toLowerCase().includes(searchTerm) ||
				(item.name && item.name.toLowerCase().includes(searchTerm)) ||
				(item.type && item.type.toLowerCase().includes(searchTerm)) ||
				(item.description && item.description.toLowerCase().includes(searchTerm))
		);

		const itemList = document.getElementById('itemList');
		itemList.innerHTML = '';

		if(filteredItems.length === 0)
		{
			itemList.innerHTML = '<div class="text-muted text-center py-4">没有找到匹配的物品</div>';
			return;
		}

		filteredItems.forEach((item, index) =>
		{
			const originalIndex = items.findIndex(i => i.id === item.id);
			const itemElement = document.createElement('div');
			itemElement.className = `item-list-item ${originalIndex === currentItemIndex ? 'active' : ''}`;

			let badgeClass = 'badge-common';
			if(item.rarity === 'uncommon') badgeClass = 'badge-uncommon';
			else if(item.rarity === 'rare') badgeClass = 'badge-rare';
			else if(item.rarity === 'epic') badgeClass = 'badge-epic';
			else if(item.rarity === 'legendary') badgeClass = 'badge-legendary';

			itemElement.innerHTML = `
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <strong>${item.name || item.id}</strong>
                        <span class="badge ${badgeClass} ms-2">${getRarityName(item.rarity)}</span>
                    </div>
                    <div class="text-end">
                        <small class="text-muted">${item.type || '无类型'}</small>
                    </div>
                </div>
                <div class="item-meta mt-1">
                    <span>ID: ${item.id}</span>
                    <span class="ms-2">价格: ${item.price}</span>
                    <span class="ms-2">权重: ${item.weight}</span>
                </div>
            `;

			itemElement.addEventListener('click', () => editItem(originalIndex));
			itemList.appendChild(itemElement);
		});
	}

	// 清空搜索
	function clearSearch()
	{
		document.getElementById('itemSearch').value = '';
		renderItemList();
	}

	// 显示效果表单
	function showEffectForm()
	{
		const container = document.getElementById('effectsContainer');

		// 如果已经有表单，先移除
		const existingForm = document.getElementById('effectForm');
		if(existingForm) existingForm.remove();

		const formHtml = `
            <div class="effect-card animate-fade-in" id="effectForm">
                <h5><i class="bi bi-gear me-2"></i>效果配置</h5>
                <div class="mb-3">
                    <label class="form-label required-field">效果类型</label>
                    <select class="form-select effect-main-type" required>
                        <option value="">-- 选择效果类型 --</option>
                        <option value="stat">属性修改</option>
                        <option value="triggered">触发效果</option>
                    </select>
                </div>

                <!-- 动态内容区域 -->
                <div id="effectDynamicFields"></div>

                <div class="d-flex justify-content-between mt-3">
                    <button type="button" class="btn btn-outline-secondary cancel-effect">
                        <i class="bi bi-x-lg me-1"></i>取消
                    </button>
                    <button type="button" class="btn btn-primary save-effect">
                        <i class="bi bi-check-lg me-1"></i>保存
                    </button>
                </div>
            </div>
        `;

		container.insertAdjacentHTML('beforeend', formHtml);

		// 主效果类型变化事件
		document.querySelector('#effectForm .effect-main-type').addEventListener('change', function ()
		{
			const type = this.value;
			const fieldsContainer = document.getElementById('effectDynamicFields');
			fieldsContainer.innerHTML = ''; // 清空容器

			if(!type) return;

			if(type === 'triggered')
			{
				// 触发效果需要先选择子类型
				const specialEventTypesConfig = effectFieldsPool.specialEventTypes;

				fieldsContainer.innerHTML = `
                    <div class="mb-3">
                        <label class="form-label required-field">${specialEventTypesConfig.label}</label>
                        <select class="form-select effect-event-type" required>
                            <option value="">-- ${specialEventTypesConfig.label} --</option>
                            ${specialEventTypesConfig.options.map(option =>
						`<option value="${option.value}">${option.text}</option>`
				).join('')}
                        </select>
                    </div>
                `;

				// 触发类型变化事件
				document.querySelector('.effect-event-type').addEventListener('change', function ()
				{
					updateEffectSubtypes(this.value);
				});
			}
			else if(type === 'stat')
			{
				// 直接生成属性修改字段
				generateStatFields();
			}
		});

		// 保存和取消按钮事件
		document.querySelector('#effectForm .save-effect').addEventListener('click', saveEffectForm);
		document.querySelector('#effectForm .cancel-effect').addEventListener('click', function ()
		{
			document.getElementById('effectForm').remove();
		});
	}

	// 删除效果
	function deleteEffect(index)
	{
		const itemIndex = document.getElementById('itemIndex').value;
		if(itemIndex === -1) return;

		const effect = items[itemIndex].effects[index];
		items[itemIndex].effects.splice(index, 1);
		saveToHistory(`删除效果: ${effect.effect || effect.stat}`);
		renderEffects(items[itemIndex].effects);
		updateJsonPreview();
		saveToLocalStorage();

		showToast('效果已删除', 'warning');
	}

	// 渲染效果列表
	function renderEffects(effects)
	{
		const container = document.getElementById('effectsContainer');
		container.innerHTML = '';

		if(effects.length === 0)
		{
			container.innerHTML = '<div class="text-muted text-center py-4">暂无效果</div>';
			return;
		}

		effects.forEach((effect, index) =>
		{
			const effectCard = document.createElement('div');
			effectCard.className = 'effect-card animate-fade-in';
			effectCard.style.animationDelay = `${index * 0.05}s`;

			let effectContent = '';
			if(effect.stat && !effect.effect)
			{
				// 属性修改效果
				effectContent = `
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <strong><i class="bi bi-graph-up me-2"></i>属性修改</strong>
                            <span class="badge bg-light text-dark ms-2">${effect.operation || '+'}</span>
                        </div>
                        <div class="effect-actions">
                            <button class="btn btn-sm btn-outline-secondary edit-effect" data-index="${index}">
                                <i class="bi bi-pencil"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-danger delete-effect" data-index="${index}">
                                <i class="bi bi-trash"></i>
                            </button>
                        </div>
                    </div>
                    <div class="effect-description mt-2">
                        <div>属性: ${getStatName(effect.stat)}</div>
                        <div>值: ${effect.value}</div>
                        <div>操作: ${effect.operation === 'add' ? '+' : effect.operation === 'subtract' ? '-' : effect.operation === 'multiply' ? '*' : effect.operation}</div>
                    </div>
                `;
			}
			else if(effect.effect === 'Triggered')
			{
				// 触发效果
				const eventName = getEventName(effect.specialEventTypes);
				const typeName = getEffectTypeName(effect.type);

				effectContent = `
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <strong><i class="bi bi-lightning me-2"></i>触发效果</strong>
                            <span class="badge bg-light text-dark ms-2">${typeName}</span>
                        </div>
                        <div class="effect-actions">
                            <button class="btn btn-sm btn-outline-secondary edit-effect" data-index="${index}">
                                <i class="bi bi-pencil"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-danger delete-effect" data-index="${index}">
                                <i class="bi bi-trash"></i>
                            </button>
                        </div>
                    <div>效果:
    <span class="effect-description">
        <!-- 触发条件  当什么时候-->
        ${eventName && (effect.type !== 'SecondHurt' && effect.type !== 'ThresholdHpAddStat' && effect.type !==
						'StatChangeOther') ? `${eventName}` : ''}

        <!-- 概率    有多少概率,如果不需要概率择不显示-->
        ${effect.triggerChance ? `，${effect.triggerChance}%概率` : ''}
        <!-- 特殊处理效果  -->
        ${effect.specialEventTypes === 'OnSecond' && effect.xSecond ?
						`每${effect.xSecond}秒` : ''}

        <!-- 效果数值 造成多少多少效果或者什么效果 -->
        ${effect.statRatio !== undefined && effect.type !== 'ThresholdHpAddStat' && effect.type !== 'StatChangeOther' && !effect.bulletType ?
						`，${effect.statRatio > 0 ? '+' : ''}${effect.statRatio}% ${getStatName(effect.stat)}` : ''}

        <!-- 特殊效果描述  特殊的效果放在这里-->
        ${effect.type === 'FullHealthHpRecover' ? `，溢出的生命再生会对敌人造成伤害` : ''}
        ${effect.type === 'ThresholdHpAddStat' ?
						`血量${effect.compares ? "低于" : "高于"}${effect.threshold * 100}%时${effect.addStat}${effect.statRatio >
						0 ? '+' : ''}${effect.statRatio}%` :
						''}
		${effect.type === 'StatChangeOther' ?
						`每持有${effect.statRatio >
						0 ? '+' : ''}${effect.statRatio}%${effect.addStat},获得${effect.otherStatRatio >
						0 ? '+' : ''}${effect.otherStatRatio}%${effect.otherAddStat}` :
						''}
        ${effect.type === 'SecondHurt' ? `，受到 ${effect.baseDamage || 0}点伤害` : ''}
        ${effect.type === 'HitExplode' ? `，发射${effect.bulletCounts || 1}枚${effect.bulletType}子弹` : ''}
        ${effect.type === 'KillPackedScene' ? `，发射${effect.bulletCounts || 1}枚${effect.bulletType}子弹` : ''}
        ${effect.type === 'WaveFreeFlush' ? `每回合获得一次免费刷新` : ''}
        ${effect.type === 'BulletLaunch' ? `子弹弹射+${effect.xSecond}` : ''}
        ${effect.type === 'FreeFlushCount' ? `获得${effect.xSecond}次刷新` : ''}
        ${effect.type === 'KillPickMaterial' ? `吸收掉落物` : ''}

        <!-- 子弹伤害详情  如果效果存在生成子弹,择生成子弹描述-->
        ${effect.bulletType ?
						` (基础伤害: ${effect.baseDamage || 0}${effect.addStat ? ` + ${effect.statRatio > 0 ? '+' : ''}${effect.statRatio}% ${getStatName(effect.stat)}` : ''})` : ''}
    </span>
</div>
                `;
			}
			effectCard.innerHTML = effectContent;
			container.appendChild(effectCard);
		});

		// 添加编辑和删除效果的监听
		document.querySelectorAll('.edit-effect').forEach(btn =>
		{
			btn.addEventListener('click', function ()
			{
				const index = parseInt(this.getAttribute('data-index'));
				editEffect(index);
			});
		});

		document.querySelectorAll('.delete-effect').forEach(btn =>
		{
			btn.addEventListener('click', function ()
			{
				const index = parseInt(this.getAttribute('data-index'));

				deleteEffect(index);

			});
		});
	}

	// 获取属性名称
	function getStatName(stat)
	{
		const statNames = {
			'Ack': '攻击力',
			'MaxHp': '最大生命值',
			'Def': '防御力',
			'AttacksPerSecond': '攻击速度',
			'Critical': '暴击率',
			'CriticalDamage': '暴击伤害',
			'LifeSteal': '生命偷取',
			'HpRecover': '生命恢复',
			'Speed': '移动速度',
			'Lucky': '幸运值',
			'Dodge': '闪避率',
			'CloseDamage': '近战伤害',
			'RemoteDamage': '远程伤害',
			'TmpAck': '临时攻击力',
			'TmpDef': '临时防御力',
			'TmpSpeed': '临时移动速度'
		};
		return statNames[stat] || stat;
	}

	// 获取事件名称
	function getEventName(eventType)
	{
		const eventNames = {
			'OnWaveStart': '波次开始时',
			'OnWaveEnd': '波次结束时',
			'OnHit': '受伤时',
			'OnKill': '击杀敌人时',
			'OnPickupMaterial': '拾取材料时',
			'OnCritical': '暴击时',
			'OnDodge': '闪避时',
			'OnSecond': '每秒',
			'OnHpChange': '血量变化时',
			'OnHalfHealth': '半血时',
			'OnSpeedChange': '移速变化时',
			'OnShopApply': '购买时生效',
			'OnStatChange': '属性变化时'
		};
		return eventNames[eventType] || eventType;
	}

	// 获取效果类型名称
	function getEffectTypeName(effectType)
	{
		for (const eventType in effectTypeMap)
		{
			const found = effectTypeMap[eventType].find(item => item.value === effectType);
			if(found)
			{
				return found.text;
			}
		}
		return effectType;
	}

	// 更新效果子类型
	function updateEffectSubtypes(eventType)
	{
		const fieldsContainer = document.getElementById('effectDynamicFields');
		const subtypeContainer = document.createElement('div');
		subtypeContainer.className = 'mb-3 effect-subtype-container';

		// 清除旧的子类型容器
		const oldContainer = fieldsContainer.querySelector('.effect-subtype-container');
		if(oldContainer) oldContainer.remove();

		if(!eventType) return;

		const subtypes = effectTypeMap[eventType] || [];

		if(subtypes.length === 0)
		{
			return;
		}

		subtypeContainer.innerHTML = `
        <label class="form-label required-field">效果类型</label>
        <select class="form-select effect-type" required>
            <option value="">-- 选择效果类型 --</option>
            ${subtypes.map(type => `
                <option value="${type.value}">${type.text}</option>
            `).join('')}
        </select>
    `;

		fieldsContainer.appendChild(subtypeContainer);

		// 子类型变化事件
		subtypeContainer.querySelector('.effect-type').addEventListener('change', function ()
		{
			const effectType = this.value;
			if(!effectType) return;

			// 生成效果字段
			generateEffectFields(effectType);
		});
	}

	function generateStatFields()
	{
		const fieldsContainer = document.getElementById('effectDynamicFields');
		fieldsContainer.innerHTML = ''; // 清空现有字段

		// 创建属性名称选择框
		const statField = createFieldElement(effectFieldsPool.stat);
		fieldsContainer.appendChild(statField);

		// 创建数值输入框
		const valueField = createFieldElement({
			type: 'number',
			label: '数值',
			value: 0.1,
			step: '0.1',
			required: true
		});
		fieldsContainer.appendChild(valueField);

		// 创建操作类型选择框(可选)
		const operationField = createFieldElement(effectFieldsPool.operation);
		operationField.querySelector('select').required = false;
		fieldsContainer.appendChild(operationField);
	}

	function createFieldElement(config)
	{
		const div = document.createElement('div');
		div.className = 'mb-3 dynamic-field';

		const label = document.createElement('label');
		label.className = 'form-label';
		label.textContent = config.label;
		if(config.required !== false)
		{
			label.classList.add('required-field');
		}

		let input;
		if(config.type === 'select')
		{
			input = document.createElement('select');
			input.className = 'form-control';

			// Handle multiple select
			if(config.multiple)
			{
				input.multiple = true;
				input.size = config.size || 4; // Default to show 4 options
			}

			// Add options
			config.options.forEach(opt =>
			{
				const option = document.createElement('option');
				option.value = opt.value;
				option.textContent = opt.text;
				input.appendChild(option);
			});
		}
		else if(config.type === 'nested')
		{
			const container = document.createElement('div');
			container.className = 'nested-field-container';

			// 添加按钮
			const addButton = document.createElement('button');
			addButton.type = 'button';
			addButton.className = 'btn btn-sm btn-outline-primary mb-2';
			addButton.innerHTML = '<i class="bi bi-plus"></i> 添加行为';
			addButton.addEventListener('click', () => addNestedField(container, config));

			container.appendChild(addButton);
			return container;
		}
		else
		{
			input = document.createElement('input');
			input.type = config.type || 'text';
			input.className = 'form-control';

			if(config.type === 'number')
			{
				if(config.step) input.step = config.step;
				if(config.min) input.min = config.min;
				if(config.max) input.max = config.max;
			}
		}

		// Set initial value
		if(config.value !== undefined)
		{
			if(input.type === 'checkbox')
			{
				input.checked = config.value;
			}
			else
			{
				input.value = config.value;
			}
		}

		// Set required attribute
		if(config.required !== false) input.required = true;

		// Add data attribute for parameter identification
		input.dataset.param = config.label.replace(/\s+/g, '').toLowerCase();

		div.appendChild(label);
		div.appendChild(input);
		return div;
	}

	function generateEffectFields(effectType)
	{
		const fieldsContainer = document.getElementById('effectDynamicFields');

		// 清除旧的参数字段（保留触发时机和效果类型选择器）
		const oldParams = fieldsContainer.querySelectorAll('.dynamic-field');
		oldParams.forEach(el =>
		{
			if(!el.closest('.effect-subtype-container') && !el.closest('.effect-event-container'))
			{
				el.remove();
			}
		});

		const config = effectParams.triggered.typeParams[effectType];
		if(!config) return;

		// 生成必填字段
		config.required.forEach(param =>
		{
			const fieldConfig = effectFieldsPool[param];
			if(fieldConfig)
			{
				fieldsContainer.appendChild(createFieldElement({
					...fieldConfig,
					required: true
				}));
			}
		});

		// 生成可选字段
		(config.optional || []).forEach(param =>
		{
			const fieldConfig = effectFieldsPool[param];
			if(fieldConfig)
			{
				fieldsContainer.appendChild(createFieldElement({
					...fieldConfig,
					required: false
				}));
			}
		});
	}

	function saveEffectForm()
	{
		const itemIndex = parseInt(document.getElementById('itemIndex').value);
		if(itemIndex === -1) return;

		const form = document.getElementById('effectForm');
		const mainType = form.querySelector('.effect-main-type').value;

		if(!mainType)
		{
			alert('请选择效果类型');
			return;
		}

		// 中文 → 英文的映射表
		const chineseToEnglishMap = {
			"属性名称": "stat",
			"数值": "value",
			"操作类型": "operation",
			"需要增加的属性": "addStat",
			"增加比例": "statRatio",
			"持有属性转换比例": "ownerRatio",
			"转换属性比例": "otherStatRatio",
			"突破上限比例": "statLimitRatio",
			"触发几率": "triggerChance",
			"子弹数量": "bulletCounts",
			"子弹类型": "bulletType",
			"穿透次数": "bulletPenetrate",
			"基础伤害": "baseDamage",
			"攻击目标数": "attackAmount",
			"什么时候条件成立": "compares",
			"条件阈值": "threshold",
			"秒": "xSecond",
			"次数": "xSecondCount",
			"需要增加的全局属性": "addGameStat",
			"突破属性上限": "statLimit",
			"持有属性": "ownerStat",
			"转换属性": "otherAddStat",
			"能否暴击": "isCritical",
			"子弹行为": "bulletBehaviors"
		};

		let effect = {};
		if(mainType === 'stat')
		{
			// 属性修改效果
			const statField = form.querySelector('[data-param="属性名称"]');
			const valueField = form.querySelector('[data-param="数值"]');
			const operationField = form.querySelector('[data-param="操作类型"]');

			if(!statField || !valueField)
			{
				alert('缺少必要的属性字段');
				return;
			}

			const value = parseFloat(valueField.value);
			if(isNaN(value))
			{
				alert('请输入有效的数值');
				return;
			}

			effect = {
				stat: statField.value,
				value: value,
				operation: operationField?.value || 'add'
			};
		}
		else if(mainType === 'triggered')
		{
			// 触发效果
			effect = {
				effect: 'Triggered',
				specialEventTypes: form.querySelector('.effect-event-type').value,
				type: form.querySelector('.effect-type')?.value
			};

			// 遍历所有动态字段，并转换键名
			form.querySelectorAll('.dynamic-field input, .dynamic-field select').forEach(field =>
			{
				let paramName = field.dataset.param;
				const value = field.value;

				if(paramName && value)
				{
					// 如果字段是中文，转换成英文
					if(chineseToEnglishMap[paramName])
					{
						paramName = chineseToEnglishMap[paramName];
					}

					// 处理多选字段
					if(field.multiple)
					{
						effect[paramName] = Array.from(field.selectedOptions).map(opt => opt.value);
					}
					else
					{
						effect[paramName] = field.type === 'number' ? parseFloat(value) : value;
					}
				}
			});

			// 处理嵌套字段 - 子弹行为
			const bulletBehaviors = [];
			form.querySelectorAll('.nested-field-group').forEach(group =>
			{
				const behavior = {};

				// 遍历组内所有输入字段
				group.querySelectorAll('input, select').forEach(field =>
				{
					const param = field.dataset.param;
					if(!param) return;

					// 映射中文参数名到英文key
					const paramMap = {
						"行为类型": "type",
						"id": "effectId",
						"最大层数": "maxStacks",
						"每层效果值": "valuePerStack",
						"持续时间(秒)": "durationPerStack"
					};

					const key = paramMap[param] || param;

					// 处理不同类型字段的值
					if(field.type === 'checkbox')
					{
						behavior[key] = field.checked;
					}
					else if(field.type === 'number')
					{
						behavior[key] = parseFloat(field.value) || 0;
					}
					else if(field.multiple)
					{
						// 处理多选字段
						behavior[key] = Array.from(field.selectedOptions).map(opt => opt.value);
					}
					else
					{
						behavior[key] = field.value;
					}
				});

				if(Object.keys(behavior).length > 0)
				{
					bulletBehaviors.push(behavior);
				}
			});
// 删除可能存在的重复字段 - 但要保留子弹行为相关字段
			const redundantFields = ["行为类型", "id", "最大层数", "每层效果值", "持续时间(秒)"];
			redundantFields.forEach(field =>
			{
				// 只有当这些字段不是子弹行为的一部分时才删除
				if(!effect.bulletBehaviors || !effect.bulletBehaviors.some(b => b[field]))
				{
					delete effect[field];
				}
			});

			// 保存子弹行为数据
			if(bulletBehaviors.length > 0)
			{
				effect.bulletBehaviors = bulletBehaviors;
			}

		}

		// 保存效果
		if(currentEffectIndex === -1)
		{
			items[itemIndex].effects.push(effect);
			saveToHistory(`添加效果: ${effect.effect || effect.stat}`);
		}
		else
		{
			items[itemIndex].effects[currentEffectIndex] = effect;
			saveToHistory(`修改效果: ${effect.effect || effect.stat}`);
		}

		form.remove();
		renderEffects(items[itemIndex].effects);
		updateJsonPreview();
		saveToLocalStorage();

		showToast('效果已保存', 'success');
	}

	// 应用效果模板
	function applyEffectTemplate(templateName)
	{
		const template = effectTemplates[templateName];
		if(!template) return;

		const itemIndex = parseInt(document.getElementById('itemIndex').value);
		if(itemIndex === -1) return;

		items[itemIndex].effects.push(JSON.parse(JSON.stringify(template)));
		saveToHistory(`应用模板: ${templateName}`);
		renderEffects(items[itemIndex].effects);
		updateJsonPreview();
		saveToLocalStorage();

		showToast('效果模板已应用', 'success');
	}

	// 更新JSON预览
	function updateJsonPreview()
	{
		const jsonOutput = document.getElementById('jsonOutput');
		const jsonEditor = document.getElementById('jsonEditor');

		try
		{
			const jsonString = JSON.stringify(items, null, 2);
			jsonOutput.value = jsonString;

			// 如果编辑器没有焦点，也更新编辑器内容
			if(document.activeElement !== jsonEditor)
			{
				jsonEditor.value = jsonString;
			}
		} catch (e)
		{
			console.error('生成JSON失败:', e);
		}
	}

	// 复制JSON到剪贴板
	function copyJsonToClipboard()
	{
		const jsonOutput = document.getElementById('jsonOutput');
		jsonOutput.select();
		document.execCommand('copy');

		// 取消选中状态
		window.getSelection().removeAllRanges();

		showToast('JSON已复制到剪贴板', 'success');
	}

	// 下载JSON
	function downloadJson()
	{
		const jsonOutput = document.getElementById('jsonOutput');
		const blob = new Blob([jsonOutput.value], {type: 'application/json'});
		const url = URL.createObjectURL(blob);
		const a = document.createElement('a');
		a.href = url;
		a.download = 'game_items.json';
		document.body.appendChild(a);
		a.click();
		document.body.removeChild(a);
		URL.revokeObjectURL(url);

		showToast('JSON文件已下载', 'success');
	}

	// 导出所有物品
	function exportAllItems()
	{
		const blob = new Blob([JSON.stringify(items, null, 2)], {type: 'application/json'});
		const url = URL.createObjectURL(blob);
		const a = document.createElement('a');
		a.href = url;
		a.download = 'all_game_items.json';
		document.body.appendChild(a);
		a.click();
		document.body.removeChild(a);
		URL.revokeObjectURL(url);

		showToast('所有物品已导出', 'success');
	}

	// 导入JSON文件
	function handleFileImport(e)
	{
		const file = e.target.files[0];
		if(!file) return;

		const reader = new FileReader();
		reader.onload = function (e)
		{
			try
			{
				const importedItems = JSON.parse(e.target.result);
				if(Array.isArray(importedItems))
				{
					items = importedItems;
					saveToHistory('导入物品数据');
					renderItemList();
					if(items.length > 0)
					{
						editItem(0);
					}
					else
					{
						addNewItem();
					}
					updateJsonPreview();
					updateItemCount();
					saveToLocalStorage();
					showToast('导入成功！', 'success');
				}
				else
				{
					showToast('导入失败：文件内容必须是物品数组', 'danger');
				}
			} catch (error)
			{
				showToast('导入失败：' + error.message, 'danger');
			}
		};
		reader.readAsText(file);
		// 重置文件输入，以便可以再次选择同一个文件
		e.target.value = '';
	}

	// 从JSON文本更新
	function updateFromJson()
	{
		const jsonOutput = document.getElementById('jsonOutput');
		try
		{
			const {value} = jsonOutput;
			const importedItems = JSON.parse(value);
			if(Array.isArray(importedItems))
			{
				items = importedItems;
				saveToHistory('从JSON更新物品数据');
				renderItemList();
				if(items.length > 0)
				{
					editItem(0);
				}
				else
				{
					addNewItem();
				}
				updateItemCount();
				saveToLocalStorage();
				showToast('更新成功！', 'success');
			}
			else
			{
				showToast('更新失败：JSON内容必须是物品数组', 'danger');
			}
		} catch (error)
		{
			showToast('更新失败：' + error.message, 'danger');
		}
	}

	// 格式化JSON
	function formatJson()
	{
		const jsonEditor = document.getElementById('jsonEditor');
		try
		{
			const parsed = JSON.parse(jsonEditor.value);
			jsonEditor.value = JSON.stringify(parsed, null, 2);
			showToast('JSON已格式化', 'success');
		} catch (e)
		{
			showToast('格式化失败：无效的JSON', 'danger');
		}
	}

	// 应用JSON更改
	function applyJsonChanges()
	{
		const jsonEditor = document.getElementById('jsonEditor');
		try
		{
			const parsed = JSON.parse(jsonEditor.value);
			if(Array.isArray(parsed))
			{
				items = parsed;
				saveToHistory('通过编辑器更新物品数据');
				renderItemList();
				if(items.length > 0)
				{
					editItem(0);
				}
				else
				{
					addNewItem();
				}
				updateItemCount();
				updateJsonPreview();
				saveToLocalStorage();
				showToast('更改已应用', 'success');
			}
			else
			{
				showToast('应用失败：必须是物品数组', 'danger');
			}
		} catch (e)
		{
			showToast('应用失败：无效的JSON', 'danger');
		}
	}

	// 撤销JSON更改
	function revertJsonChanges()
	{
		const jsonEditor = document.getElementById('jsonEditor');
		jsonEditor.value = JSON.stringify(items, null, 2);
		showToast('更改已撤销', 'info');
	}

	// 保存历史记录
	function saveToHistory(action)
	{
		// 如果当前指针不在最后，截断历史记录
		if(historyPointer < historyStack.length - 1)
		{
			historyStack = historyStack.slice(0, historyPointer + 1);
		}

		// 添加新状态
		historyStack.push({
			action: action,
			items: JSON.parse(JSON.stringify(items)),
			currentItemIndex: currentItemIndex
		});

		// 限制历史记录长度
		if(historyStack.length > 50)
		{
			historyStack.shift();
		}

		historyPointer = historyStack.length - 1;
	}

	// 显示Toast通知
	function showToast(message, type = 'info')
	{
		const toastContainer = document.createElement('div');
		toastContainer.className = `toast show align-items-center text-white bg-${type} border-0`;
		toastContainer.style.position = 'fixed';
		toastContainer.style.bottom = '20px';
		toastContainer.style.right = '20px';
		toastContainer.style.zIndex = '9999';

		toastContainer.innerHTML = `
        <div class="d-flex">
            <div class="toast-body">
                ${message}
            </div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
    `;

		document.body.appendChild(toastContainer);

		// 自动消失
		setTimeout(() =>
		{
			toastContainer.classList.remove('show');
			setTimeout(() =>
			{
				toastContainer.remove();
			}, 300);
		}, 3000);

		// 点击关闭
		toastContainer.querySelector('.btn-close').addEventListener('click', () =>
		{
			toastContainer.classList.remove('show');
			setTimeout(() =>
			{
				toastContainer.remove();
			}, 300);
		});
	}

	// 修改addNestedField函数以支持预设值
	function addNestedField(container, config, presetValues = {})
	{
		const fieldGroup = document.createElement('div');
		fieldGroup.className = 'nested-field-group mb-3 p-3 border rounded';

		// 添加删除按钮
		const deleteButton = document.createElement('button');
		deleteButton.type = 'button';
		deleteButton.className = 'btn btn-sm btn-outline-danger float-end';
		deleteButton.innerHTML = '<i class="bi bi-trash"></i>';
		deleteButton.addEventListener('click', () => fieldGroup.remove());

		fieldGroup.appendChild(deleteButton);

		// 添加字段并设置预设值
		config.fields.forEach(fieldConfig =>
		{
			const fieldDiv = createFieldElement({
				...fieldConfig,
				value: presetValues[fieldConfig.label.replace(/\s+/g, '').toLowerCase()]
			});
			fieldGroup.appendChild(fieldDiv);
		});

		container.insertBefore(fieldGroup, container.lastElementChild);
	}

	function editEffect(index)
	{
		const itemIndex = parseInt(document.getElementById('itemIndex').value);
		if(itemIndex === -1) return;
		// 如果点击的是当前正在编辑的效果，则取消编辑
		if(isEditingEffect && currentEditingEffectIndex === index)
		{
			cancelEffectEditing();
			return;
		}

		const effect = items[itemIndex].effects[index];
		currentEffectIndex = index;
		currentEditingEffectIndex = index;
		isEditingEffect = true;

		showEffectForm();
		// 高亮当前正在编辑的效果
		highlightEditingEffect(index);
		// 使用更可靠的延迟确保DOM加载完成
		const tryFillForm = (attempt = 0) =>
		{
			const form = document.getElementById('effectForm');
			if(!form && attempt < 5)
			{
				setTimeout(() => tryFillForm(attempt + 1), 100);
				return;
			}
			if(!form) return;

			// 1. 设置主效果类型
			if(effect.effect === 'Triggered')
			{
				form.querySelector('.effect-main-type').value = 'triggered';
				const event = new Event('change');
				form.querySelector('.effect-main-type').dispatchEvent(event);

				// 2. 设置事件类型
				setTimeout(() =>
				{
					if(effect.specialEventTypes)
					{
						form.querySelector('.effect-event-type').value = effect.specialEventTypes;
						form.querySelector('.effect-event-type').dispatchEvent(new Event('change'));

						// 3. 设置效果类型
						setTimeout(() =>
						{
							if(effect.type)
							{
								form.querySelector('.effect-type').value = effect.type;
								form.querySelector('.effect-type').dispatchEvent(new Event('change'));

								// 4. 设置其他参数
								setTimeout(() =>
								{
									Object.keys(effect).forEach(key =>
									{
										if(!['effect', 'specialEventTypes', 'type', 'bulletBehaviors'].includes(key))
										{
											const input = form.querySelector(`[data-param="${key}"]`);
											if(input)
											{
												if(input.type === 'checkbox')
												{
													input.checked = effect[key];
												}
												else
												{
													input.value = effect[key];
												}
											}
										}
									});

									// 5. 加载子弹行为（关键修改）
									if(effect.bulletBehaviors?.length > 0)
									{
										const container = form.querySelector('.nested-field-container');
										if(container)
										{
											// 先清空现有字段
											container.querySelectorAll('.nested-field-group').forEach(g => g.remove());

											// 添加子弹行为数据
											effect.bulletBehaviors.forEach(behavior =>
											{
												addNestedFieldWithData(container, behavior);
											});
										}
									}
								}, 50);
							}
						}, 50);
					}
				}, 50);
			}
		};

		tryFillForm();
	}

	function addNestedFieldWithData(container, behaviorData)
	{
		const config = effectFieldsPool.bulletBehaviors;
		const fieldGroup = document.createElement('div');
		fieldGroup.className = 'nested-field-group mb-3 p-3 border rounded';

		// 删除按钮
		const deleteButton = document.createElement('button');
		deleteButton.type = 'button';
		deleteButton.className = 'btn btn-sm btn-outline-danger float-end';
		deleteButton.innerHTML = '<i class="bi bi-trash"></i>';
		deleteButton.addEventListener('click', () => fieldGroup.remove());
		fieldGroup.appendChild(deleteButton);

		// 添加字段并填充数据
		config.fields.forEach(fieldConfig =>
		{
			const fieldDiv = document.createElement('div');
			fieldDiv.className = 'mb-2';

			const label = document.createElement('label');
			label.className = 'form-label small';
			label.textContent = fieldConfig.label;
			fieldDiv.appendChild(label);

			let input;
			if(fieldConfig.type === 'select')
			{
				input = document.createElement('select');
				input.className = 'form-control form-control-sm';
				input.dataset.param = fieldConfig.label; // 使用label作为param

				// 添加选项
				fieldConfig.options.forEach(opt =>
				{
					const option = document.createElement('option');
					option.value = opt.value;
					option.textContent = opt.text;
					input.appendChild(option);
				});

				// 设置选中值
				const valueKey = fieldConfig.param || fieldConfig.label.replace(/\s+/g, '').toLowerCase();
				if(behaviorData[valueKey] !== undefined)
				{
					input.value = behaviorData[valueKey];
				}
			}
			else
			{
				input = document.createElement('input');
				input.type = fieldConfig.type || 'text';
				input.className = 'form-control form-control-sm';
				input.dataset.param = fieldConfig.label; // 使用label作为param

				// 设置值
				const valueKey = fieldConfig.param || fieldConfig.label.replace(/\s+/g, '').toLowerCase();
				if(behaviorData[valueKey] !== undefined)
				{
					input.value = behaviorData[valueKey];
				}

				if(fieldConfig.placeholder)
				{
					input.placeholder = fieldConfig.placeholder;
				}

				// 数字字段的特殊属性
				if(fieldConfig.type === 'number')
				{
					if(fieldConfig.min !== undefined) input.min = fieldConfig.min;
					if(fieldConfig.max !== undefined) input.max = fieldConfig.max;
					if(fieldConfig.step !== undefined) input.step = fieldConfig.step;
				}
			}

			fieldDiv.appendChild(input);
			fieldGroup.appendChild(fieldDiv);
		});

		container.insertBefore(fieldGroup, container.lastElementChild);
	}

	function cancelEffectEditing()
	{
		const form = document.getElementById('effectForm');
		if(form)
		{
			form.remove();
		}
		isEditingEffect = false;
		currentEditingEffectIndex = -1;

		// 移除高亮效果
		const effectsContainer = document.getElementById('effectsContainer');
		effectsContainer.querySelectorAll('.editing-effect').forEach(el =>
		{
			el.classList.remove('editing-effect');
		});

		showToast('已取消编辑', 'info');
	}

	function highlightEditingEffect(index)
	{
		// 先移除所有高亮
		const effectsContainer = document.getElementById('effectsContainer');
		effectsContainer.querySelectorAll('.editing-effect').forEach(el =>
		{
			el.classList.remove('editing-effect');
		});

		// 高亮当前编辑的效果
		const effectCards = effectsContainer.querySelectorAll('.effect-card');
		if(index >= 0 && index < effectCards.length)
		{
			effectCards[index].classList.add('editing-effect');
		}
	}

	// 更新JSON预览函数
	function updateJsonPreview()
	{
		const jsonOutput = document.getElementById('jsonOutput');
		const currentItemJson = document.getElementById('currentItemJson');
		const jsonEditor = document.getElementById('jsonEditor');

		try
		{
			// 更新所有物品JSON
			const jsonString = JSON.stringify(items, null, 2);
			jsonOutput.value = jsonString;

			// 更新当前物品JSON
			if(currentItemIndex >= 0 && currentItemIndex < items.length)
			{
				currentItemJson.value = JSON.stringify(items[currentItemIndex], null, 2);
			}
			else
			{
				currentItemJson.value = '暂无选中物品';
			}

			// 如果编辑器没有焦点，也更新编辑器内容
			if(document.activeElement !== jsonEditor)
			{
				jsonEditor.value = jsonString;
			}
		} catch (e)
		{
			console.error('生成JSON失败:', e);
		}
	}

	// 复制当前物品JSON
	document.getElementById('btnCopyCurrentJson').addEventListener('click', function ()
	{
		const currentItemJson = document.getElementById('currentItemJson');
		currentItemJson.select();
		document.execCommand('copy');
		window.getSelection().removeAllRanges();
		showToast('当前物品JSON已复制到剪贴板', 'success');
	});

	// 下载当前物品JSON
	document.getElementById('btnDownloadCurrentJson').addEventListener('click', function ()
	{
		const currentItemJson = document.getElementById('currentItemJson');
		const blob = new Blob([currentItemJson.value], {type: 'application/json'});
		const url = URL.createObjectURL(blob);
		const a = document.createElement('a');
		a.href = url;

		// 使用当前物品ID作为文件名，如果没有ID则使用默认名称
		const currentItem = items[currentItemIndex];
		a.download = currentItem && currentItem.id ? `${currentItem.id}.json` : 'current_item.json';
		document.body.appendChild(a);
		a.click();
		document.body.removeChild(a);
		URL.revokeObjectURL(url);
		showToast('当前物品JSON已下载', 'success');
	});
	// 移动菜单功能
	document.getElementById('mobileMenuBtn').addEventListener('click', function ()
	{
		// 实现简单的侧边菜单或下拉菜单
		alert('移动菜单功能 - 可以扩展为实际的下拉菜单或侧边栏');
	});

	// 移动底部导航按钮功能
	document.getElementById('mobileAddItemBtn').addEventListener('click', function ()
	{
		addNewItem();
		// 滚动到顶部
		window.scrollTo(0, 0);
	});

	document.getElementById('mobileSaveBtn').addEventListener('click', function ()
	{
		saveItem();
	});

	document.getElementById('mobileJsonBtn').addEventListener('click', function ()
	{
		// 展开JSON编辑器
		const collapse = new bootstrap.Collapse(document.getElementById('jsonEditorCollapse'), {
			toggle: true
		});
		// 滚动到JSON编辑器
		document.getElementById('jsonEditorCollapse').scrollIntoView({
			behavior: 'smooth'
		});
	});
</script>
